<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cafe Owner Registration</title>
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    header {
      border-bottom: none !important;
    }
    
    main {
      padding: 20px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, textarea {
  width: 300px;
  padding: 12px 16px;
  margin-top: 8px;
  margin-bottom: 16px;
  border: 1px solid #ccc;
  border-radius: 12px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  font-size: 16px;
  font-family: inherit;
  transition: border-color 0.3s, box-shadow 0.3s;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: #6c63ff;
  box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
}
    button {
      margin-top: 15px;
      padding: 8px 16px;
    }
    #errorMsg {
      color: red;
      font-weight: bold;
      margin-bottom: 10px;
    }
    #successMsg {
      color: green;
      font-weight: bold;
      margin-top: 10px;
    }
    .form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  max-width: 700px;
}

.form-grid .full {
  grid-column: span 2;
}

input, select, textarea {
  width: 100%;
  padding: 14px 18px;
  border: 1px solid #ccc;
  border-radius: 999px;
  font-size: 15px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  font-family: inherit;
}

textarea {
  border-radius: 20px;
  resize: vertical;
  min-height: 100px;
}

input::placeholder, textarea::placeholder, select {
  color: #888;
  font-weight: 400;
}

select {
  appearance: none;
  background-color: white;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 16px center;
  background-size: 16px;
  cursor: pointer;
}

@media (max-width: 600px) {
  .form-grid {
    grid-template-columns: 1fr;
  }
}
  .error {
  color: red;
}

.success {
  color: green;
}

.image-preview {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 10px;
}

.preview-item {
  position: relative;
  display: inline-block;
}

.preview-image {
  width: 100px;
  height: 100px;
  object-fit: cover;
  border-radius: 8px;
  border: 2px solid #ddd;
}

.remove-image {
  position: absolute;
  top: -5px;
  right: -5px;
  background-color: #dc3545;
  color: white;
  border: none;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  font-size: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.remove-image:hover {
  background-color: #c82333;
}

input[type="file"] {
  padding: 12px 16px;
  border: 2px dashed #ccc;
  border-radius: 8px;
  background-color: #f9f9f9;
  cursor: pointer;
  transition: border-color 0.3s;
}

input[type="file"]:hover {
  border-color: #a87544;
}
    
  </style>
</head>
  
<body>
    <!-- Header -->
  <header>
    <h1><a href="../index.html">Cafe Spot Finder</a></h1>
    <nav>
      <a href="../search/index.html">Search</a>
      <a href="../my-favorites/index.html">My Favorites</a>
      <a href="../login/index.html">Login</a>
    </nav>
  </header>

  <main>
    <h1>Register Your Cafe</h1>
    <p> Please enter all fields to register your cafe </p>

    <p id="message"></p>

    <form id="registrationForm" action="#" method="post" class="registration-form" novalidate>

  <div class="form-group">
    <input type="text" id="cafeName" name="cafe-name" placeholder=" " required />
    <label for="cafeName">Cafe Name</label>
  </div>

  <div class="form-group">
    <input type="text" id="address" name="address" placeholder=" " required />
    <label for="address">Address</label>
  </div>

  <div class="form-group">
    <input type="text" id="description" name="description" placeholder=" " required />
    <label for="description">Cafe Description</label>
  </div>
  
  <div class="form-group">
    <input type="text" id="amenities" name="amenities" placeholder=" " required />
    <label for="amenities">Amenities</label>
  </div>
  
  <div class="form-group">
    <input type="tel" id="phone" name="phone" placeholder=" " required />
    <label for="phone">Phone Number</label>
  </div>

  <div class="form-group">
    <input type="url" id="website" name="website" placeholder=" " />
    <label for="website">Cafe Website</label>
  </div>

  <div class="form-group">
    <input type="text" id="hours" name="opening-hours" placeholder=" " required />
    <label for="hours">Opening Hours</label>
  </div>

  <div class="form-group">
    <input type="number" id="seats" name="seats" placeholder=" " required />
    <label for="seats">Total Seats</label>
  </div>

  <div class="form-group">
    <input type="number" id="outlets" name="power-outlets" placeholder=" " required />
    <label for="outlets">Power Outlets</label>
  </div>

  <div class="form-group">
    <select id="noise" name="noise-level" value="" placeholder=" " required>
      <option value="" disabled selected hidden></option>
      <option value="quiet">Quiet</option>
      <option value="moderate">Moderate</option>
      <option value="loud">Loud</option>
    </select>
    <label for="noise">Noise Level</label>
  </div>

  <div class="form-group">
    <input type="text" id="ownerName" name="owner-name" placeholder=" " required />
    <label for="owner">Owner’s Name</label>
  </div>

  <div class="form-group">
    <input type="email" id="email" name="email" placeholder=" " required />
    <label for="email">Email Address</label>
  </div>
  
   <div class="form-group">
    <input type="password" id="password" name="password" placeholder=" " required />
    <label for="password">Password</label>
  </div>
   
    <div class="form-group">
    <input type="password" id="confirmPassword" name="confirmPassword" placeholder=" " required />
    <label for="confirmPassword">Confirm Password</label>
  </div>
  
  <div class="form-group">
    <input type="file" id="cafeImages" name="cafe-images" multiple accept="image/*" />
    <label for="cafeImages">Cafe Images (Upload multiple images)</label>
    <div id="imagePreview" class="image-preview"></div>
  </div>
  
      <div class="button-group">
        <button type="submit">Register</button>
      </div>
    </form>
  </main>
  
  <!-- Footer -->
<footer>
        <p>&copy; 2024 Cafe Spot Finder. All rights reserved.</p>
        <div>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
            <a href="#">Contact Us</a>
        </div>
    </footer>

    <script>
        let uploadedImages = [];

        // Handle image upload and preview
        document.getElementById('cafeImages').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            const imagePreview = document.getElementById('imagePreview');
            
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = {
                            name: file.name,
                            data: e.target.result,
                            alt: `${document.getElementById('cafeName').value || 'Cafe'} - ${file.name}`
                        };
                        
                        uploadedImages.push(imageData);
                        
                        // Create preview element
                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="${file.name}" class="preview-image">
                            <button type="button" class="remove-image" onclick="removeImage(${uploadedImages.length - 1})">×</button>
                        `;
                        
                        imagePreview.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                }
            });
        });

        // Function to remove image from preview and array (global scope)
        window.removeImage = function(index) {
            uploadedImages.splice(index, 1);
            refreshImagePreview();
        }

        // Refresh image preview display
        function refreshImagePreview() {
            const imagePreview = document.getElementById('imagePreview');
            imagePreview.innerHTML = '';
            
            uploadedImages.forEach((image, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                previewItem.innerHTML = `
                    <img src="${image.data}" alt="${image.name}" class="preview-image">
                    <button type="button" class="remove-image" onclick="removeImage(${index})">×</button>
                `;
                imagePreview.appendChild(previewItem);
            });
        }

        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form data
            const formData = {
                name: document.getElementById('cafeName').value.trim(),
                address: document.getElementById('address').value.trim(),
                about: document.getElementById('description').value.trim(),
                amenities: document.getElementById('amenities').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                website: document.getElementById('website').value.trim() || 'N/A',
                hours: document.getElementById('hours').value.trim(),
                totalSeats: parseInt(document.getElementById('seats').value),
                totalOutlets: parseInt(document.getElementById('outlets').value),
                noiseLevel: document.getElementById('noise').value,
                ownerName: document.getElementById('ownerName').value.trim(),
                email: document.getElementById('email').value.trim(),
                password: document.getElementById('password').value,
                confirmPassword: document.getElementById('confirmPassword').value
            };
            
            // Validate required fields
            if (!formData.name || !formData.address || !formData.about || !formData.amenities || 
                !formData.phone || !formData.hours || !formData.totalSeats || !formData.totalOutlets || 
                !formData.noiseLevel || !formData.ownerName || !formData.email || !formData.password) {
                alert('Please fill in all required fields.');
                return;
            }
            
            // Validate password match
            if (formData.password !== formData.confirmPassword) {
                alert('Passwords do not match.');
                return;
            }
            
            // Generate unique cafe ID
            const cafeId = 'cafe_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Create cafe data object
            const cafeData = {
                id: cafeId,
                name: formData.name,
                address: formData.address,
                phone: formData.phone,
                hours: formData.hours,
                website: formData.website,
                about: formData.about,
                amenities: formData.amenities,
                status: {
                    seats: { 
                        available: Math.floor(formData.totalSeats * 0.7), // Assume 70% available
                        total: formData.totalSeats 
                    },
                    outlets: { 
                        available: Math.floor(formData.totalOutlets * 0.8), // Assume 80% available
                        total: formData.totalOutlets 
                    },
                    noise: formData.noiseLevel.charAt(0).toUpperCase() + formData.noiseLevel.slice(1),
                    lastUpdated: "Just now"
                },
                images: uploadedImages.length > 0 ? uploadedImages.map(img => ({
                    src: img.data,
                    alt: img.alt || `${formData.name} - ${img.name}`
                })) : [
                    { src: "../../assets/landing-bg.jpg", alt: formData.name + " Interior" },
                    { src: "../../assets/landing-bg-2.png", alt: formData.name + " Exterior" },
                    { src: "../../assets/landing-bg-3.png", alt: formData.name + " Menu" }
                ],
                owner: {
                    name: formData.ownerName,
                    email: formData.email
                },
                createdAt: new Date().toISOString(),
                isOwnerRegistered: true
            };
            
            // Save to localStorage
            let registeredCafes = JSON.parse(localStorage.getItem('registeredCafes') || '{}');
            registeredCafes[cafeId] = cafeData;
            localStorage.setItem('registeredCafes', JSON.stringify(registeredCafes));
            
            // Show success message
            document.getElementById('message').innerHTML = '<span class="success">✅ Cafe registered successfully!</span>';
            document.getElementById('message').style.display = 'block';
            
            // Redirect to cafe detail page after 2 seconds
            setTimeout(() => {
                window.location.href = `../cafes/cafe_detail/index.html?id=${cafeId}`;
            }, 2000);
        });
    </script>
  
</body>
</html>
